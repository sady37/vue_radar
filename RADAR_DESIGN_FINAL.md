# 雷达绘制设计（最终版）

## 🎨 统一设计理念

### 核心原则
**三种模式使用统一的设计语言，只是形状不同**

```
Ceiling: 360度圆形（全向监测）
Wall:    140度扇形（定向监测）
Corn:    90度扇形（角落监测）
```

---

## 📊 三种模式对比

| 元素 | Ceiling | Wall | Corn |
|------|---------|------|------|
| **主体形状** | 3个同心圆 | 3个同心扇形(140°) | 3个同心扇形(90°) |
| **坐标线** | ✅ H轴+V轴 | ✅ H轴+V轴 | ✅ H轴+V轴 |
| **外圈半径** | 15px | 15px | 15px |
| **中圈半径** | 10px | 10px | 10px |
| **内圈半径** | 5px | 5px | 5px |
| **颜色渐变** | 蓝色渐变 | 蓝色渐变 | 蓝色渐变 |
| **LED指示器** | 绿色矩形 | 绿色矩形 | 绿色矩形 |
| **LED位置** | +V方向(下方) | -V方向(上方) | -V方向(上方) |
| **LED尺寸** | 7×2.1px | 7×2.1px | 7×2.1px |
| **模式标识** | "C" | "W" | "Co" |

---

## 🎨 详细设计

### Ceiling 模式（天花板安装）

**绘制元素**：
```
1. 坐标线（灰色）
   - H轴：±15px（左正右负）
   - V轴：±15px

2. 3个同心圆（蓝色渐变）
   - 外圈：15px，浅蓝 rgba(190, 227, 248, 0.5)
   - 中圈：10px，中蓝 rgba(99, 179, 237, 0.5)
   - 内圈：5px，深蓝 rgba(49, 130, 206, 0.5)

3. LED指示器（绿色矩形）
   - 位置：+V方向，Y=17px（下方）
   - 尺寸：7×2.1px（增大40%）
   - 颜色：rgb(116, 199, 151)

4. 模式标识
   - 文字："C"
   - 位置：LED下方8px
```

**视觉示意**：
```
     │ V轴
  ───┼───  H轴
     │
   ╱─●─╲
  ●─────●  3个同心圆
   ╲─●─╱   蓝色渐变
     │
    ▓▓▓    绿色LED
     C     模式标识
```

---

### Wall 模式（墙壁安装）

**绘制元素**：
```
1. 坐标线（灰色）
   - H轴：±15px
   - V轴：±15px

2. 3个同心扇形（蓝色渐变，140度）
   - 扇形角度：沿Y轴对称，左右各70度
   - 起始角：20° (90°-70°)
   - 结束角：160° (90°+70°)
   - 外扇形：15px
   - 中扇形：10px
   - 内扇形：5px

3. LED指示器（绿色矩形）
   - 位置：-V方向，Y=-17px（上方）
   - 尺寸：7×2.1px
   - 颜色：rgb(116, 199, 151)

4. 模式标识
   - 文字："W"
   - 位置：LED上方8px
```

**视觉示意**：
```
     W     模式标识
    ▓▓▓    绿色LED
     │
   ╱─●─╲
  ╱  │  ╲  3个同心扇形
 ╱───●───╲ 蓝色渐变
╱    │    ╲ 140度
  ───┼───  H轴
     │ V轴
```

---

### Corn 模式（墙角安装）

**绘制元素**：
```
1. 坐标线（灰色）
   - H轴：±15px
   - V轴：±15px

2. 3个同心扇形（蓝色渐变，90度）
   - 扇形角度：沿Y轴对称，左右各45度
   - 起始角：45° (90°-45°)
   - 结束角：135° (90°+45°)
   - 外扇形：15px
   - 中扇形：10px
   - 内扇形：5px

3. LED指示器（绿色矩形）
   - 位置：-V方向，Y=-17px（上方）
   - 尺寸：7×2.1px
   - 颜色：rgb(116, 199, 151)

4. 模式标识
   - 文字："Co"
   - 位置：LED上方8px
```

**视觉示意**：
```
     Co    模式标识
    ▓▓▓    绿色LED
     │
    ╱●╲
   ╱ │ ╲   3个同心扇形
  ╱──●──╲  蓝色渐变
 ╱   │   ╲ 90度
  ───┼───  H轴
     │ V轴
```

---

## 🔑 关键参数

### 通用参数
```typescript
scale = 1;  // 缩放比例

// 坐标线
lineColor = 'rgb(113, 128, 150)';
lineWidth = 0.2;

// LED指示器
ledWidth = 5 * 1.4 = 7px;      // 增大40%
ledHeight = 1.5 * 1.4 = 2.1px; // 增大40%
ledFillColor = 'rgb(116, 199, 151)';
ledStrokeColor = 'rgb(47, 133, 90)';

// 模式标识
fontSize = 8px;
textColor = 'rgb(74, 85, 104)';
```

### 同心圆/扇形参数
```typescript
// 半径
outerRadius = 15 * scale;  // 外圈
middleRadius = 10 * scale; // 中圈
innerRadius = 5 * scale;   // 内圈

// 颜色（从外到内，逐渐加深）
outerFill = 'rgba(190, 227, 248, 0.5)';
outerStroke = 'rgba(144, 205, 244, 0.5)';

middleFill = 'rgba(99, 179, 237, 0.5)';
middleStroke = 'rgba(66, 153, 225, 0.5)';

innerFill = 'rgba(49, 130, 206, 0.5)';
innerStroke = 'rgba(43, 108, 176, 0.5)';
```

### Wall扇形参数
```typescript
halfAngle = 70 * Math.PI / 180;   // 70度
centerAngle = Math.PI / 2;         // 90度
startAngle = centerAngle - halfAngle; // 20°
endAngle = centerAngle + halfAngle;   // 160°
```

### Corn扇形参数
```typescript
halfAngle = 45 * Math.PI / 180;   // 45度
centerAngle = Math.PI / 2;         // 90度
startAngle = centerAngle - halfAngle; // 45°
endAngle = centerAngle + halfAngle;   // 135°
```

---

## 📐 LED指示器位置说明

### Ceiling模式
```
LED在+V方向（下方，Y=+17）
表示：雷达朝向前方

理由：
- Ceiling模式从上往下看
- +V是前方
- LED指向监测方向
```

### Wall/Corn模式
```
LED在-V方向（上方，Y=-17）
表示：雷达在墙上，LED在内扇形顶部

理由：
- Wall/Corn模式从侧面看
- 雷达贴墙，+V是前方（向下）
- LED在最小扇形顶部（-V方向）
- 更接近实际物理位置
```

**关键差异**：
```
Ceiling: indicatorY = +17 (下方)
Wall:    indicatorY = -17 (上方)
Corn:    indicatorY = -17 (上方)
```

---

## 🎯 统一的视觉语言

### 1. 颜色体系
```
主体：蓝色系渐变（3层）
坐标线：灰色
LED：绿色
文字：深灰色
```

### 2. 尺寸体系
```
半径：15px, 10px, 5px（3:2:1）
LED：7×2.1px（宽×高）
字体：8px
```

### 3. 层次结构
```
1. 坐标线（最底层，灰色）
2. 外圈/扇形（浅蓝）
3. 中圈/扇形（中蓝）
4. 内圈/扇形（深蓝）
5. LED指示器（绿色，最醒目）
6. 模式标识（文字）
```

---

## 🔧 代码实现要点

### 1. 使用相对坐标
```typescript
// 所有绘制以(0, 0)为中心
ctx.translate(position.x, position.y);

// 绘制时直接使用相对坐标
ctx.arc(0, 0, radius, ...);
```

### 2. 扇形绘制
```typescript
// 扇形需要lineTo(0, 0)封闭路径
ctx.arc(0, 0, radius, startAngle, endAngle);
ctx.lineTo(0, 0);
ctx.closePath();
```

### 3. LED居中
```typescript
// 通过-width/2使矩形居中
ctx.rect(-ledWidth/2, (indicatorY - ledHeight/2), ledWidth, ledHeight);
```

### 4. 旋转在上层处理
```typescript
// drawObjects.ts中处理旋转
if (obj.angle && obj.angle !== 0) {
  ctx.save();
  ctx.translate(position.x, position.y);
  ctx.rotate((obj.angle * Math.PI) / 180);
  ctx.translate(-position.x, -position.y);
  drawRadarDevice(ctx, position, visual, setupModel);
  ctx.restore();
}
```

---

## 💡 设计理由

### 1. 为什么统一设计？
- **一致性**：用户一眼就能识别是雷达设备
- **易理解**：只是形状不同（圆vs扇形），其他元素相同
- **专业性**：统一的视觉语言更专业

### 2. 为什么用3层渐变？
- **层次感**：清晰表达监测范围的层次
- **视觉吸引**：渐变色更美观
- **参考现实**：模拟雷达波的辐射范围

### 3. 为什么Wall/Corn的LED在上方？
- **物理真实**：雷达贴墙时，LED通常在设备顶部
- **视觉一致**：LED总是在最小圆/扇形的边缘
- **清晰标识**：避免与坐标线重叠

### 4. 为什么增大LED尺寸？
- **可见性**：更容易看到LED指示器
- **重要性**：LED表示设备方向，需要醒目
- **比例协调**：7×2.1px与15px半径更协调

---

## 🎨 色彩说明

### 蓝色渐变（由浅到深）
```
外圈：rgba(190, 227, 248, 0.5) - 非常浅的蓝色
      rgba(144, 205, 244, 0.5) - 边框

中圈：rgba(99, 179, 237, 0.5)  - 中等蓝色
      rgba(66, 153, 225, 0.5)  - 边框

内圈：rgba(49, 130, 206, 0.5)  - 较深蓝色
      rgba(43, 108, 176, 0.5)  - 边框
```

### 其他颜色
```
坐标线：rgb(113, 128, 150)    - 灰蓝色
LED填充：rgb(116, 199, 151)    - 草绿色
LED边框：rgb(47, 133, 90)      - 深绿色
文字：   rgb(74, 85, 104)      - 深灰色
```

---

## 📏 尺寸标注图

### Ceiling模式
```
      ─15─
    ╱     ╲
   │  ─10─ │
   │ ╱   ╲ │
   │ │ 5 │ │  半径：15, 10, 5
   │ ╲   ╱ │
   │  ───  │
    ╲     ╱
      ───
      17↓
      ▓7▓   LED宽7
      ─2.1  LED高2.1
```

### Wall模式（140度）
```
      ─15─
    ╱     ╲
   ╱   W   ╲  模式标识
  ╱   ▓▓▓  ╲  LED（上方）
  │    ↑17  │
  │  ─10─  │
  │ ╱   ╲ │
  │ │ 5 │ │  半径：15, 10, 5
  │ ╲   ╱ │
  │  ───  │
  ╲       ╱
   ╲─────╱
    140°
```

---

## 🔍 完整对比表

| 特征 | Ceiling | Wall | Corn |
|------|---------|------|------|
| **角度范围** | 360° | 140° | 90° |
| **半角** | - | ±70° | ±45° |
| **形状** | 圆形 | 扇形 | 扇形 |
| **同心层数** | 3层 | 3层 | 3层 |
| **半径** | 15,10,5 | 15,10,5 | 15,10,5 |
| **颜色** | 蓝色渐变 | 蓝色渐变 | 蓝色渐变 |
| **坐标线** | ✅ | ✅ | ✅ |
| **LED位置** | Y=+17 | Y=-17 | Y=-17 |
| **LED尺寸** | 7×2.1 | 7×2.1 | 7×2.1 |
| **标识** | "C" | "W" | "Co" |
| **应用** | 天花板 | 墙壁 | 墙角 |

---

**文件**：`src/utils/drawDevices.ts`  
**版本**：v3.0 Final  
**更新**：2025-10-29  
**状态**：✅ 统一设计完成

