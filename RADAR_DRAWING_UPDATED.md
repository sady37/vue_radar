# é›·è¾¾ç»˜åˆ¶å®ç°è¯´æ˜ï¼ˆæ›´æ–°ç‰ˆï¼‰

## ğŸ“‹ æ ¸å¿ƒè®¾è®¡åŸåˆ™

### 1. æ—‹è½¬ç”±ä¸Šå±‚å¤„ç†
```
âŒ é”™è¯¯ï¼šåœ¨ç»˜åˆ¶å‡½æ•°ä¸­å¤„ç†æ—‹è½¬
âœ… æ­£ç¡®ï¼šåœ¨ drawObjects.ts ä¸­å¤„ç†æ—‹è½¬ï¼Œç»˜åˆ¶å‡½æ•°åªè´Ÿè´£ç»˜åˆ¶
```

**åŸå› **ï¼š
- æ—‹è½¬æ˜¯å¯¹æ•´ä¸ªå¯¹è±¡çš„å˜æ¢ï¼Œä¸æ˜¯å›¾æ ‡çš„ä¸€éƒ¨åˆ†
- ä¿æŒç»˜åˆ¶å‡½æ•°çš„èŒè´£å•ä¸€
- æ›´å¥½çš„ä»£ç åˆ†å±‚

### 2. ä½¿ç”¨ç›¸å¯¹åæ ‡ç»˜åˆ¶
```
æ‰€æœ‰å›¾æ ‡éƒ½ä»¥ (0, 0) ä¸ºä¸­å¿ƒç»˜åˆ¶
é€šè¿‡ ctx.translate() ç§»åŠ¨åˆ°ç›®æ ‡ä½ç½®
```

---

## ğŸ¨ ä¸‰ç§æ¨¡å¼å®ç°

### Ceiling æ¨¡å¼ï¼ˆé¡¶è£…ï¼‰

**å‚è€ƒä¹‹å‰é¡¹ç›®çš„å®ç°**

**ç»˜åˆ¶å†…å®¹**ï¼š
1. **åæ ‡çº¿**ï¼šHè½´ï¼ˆå·¦æ­£å³è´Ÿï¼‰å’ŒVè½´
2. **3ä¸ªåŒå¿ƒåœ†**ï¼š
   - å¤–åœˆï¼š15pxï¼Œæµ…è“è‰² `rgba(190, 227, 248, 0.5)`
   - ä¸­åœˆï¼š10pxï¼Œä¸­è“è‰² `rgba(99, 179, 237, 0.5)`
   - å†…åœˆï¼š5pxï¼Œæ·±è“è‰² `rgba(49, 130, 206, 0.5)`
3. **LEDæŒ‡ç¤ºå™¨**ï¼šç»¿è‰²çŸ©å½¢ï¼Œä½äº+Væ–¹å‘ï¼ˆä¸‹æ–¹17pxï¼‰
4. **æ¨¡å¼æ ‡è¯†**ï¼š"C"å­—ç¬¦

**ä»£ç å®ç°**ï¼š
```typescript
// 1. åæ ‡çº¿
ctx.moveTo(15, 0);   // Hè½´
ctx.lineTo(-15, 0);
ctx.moveTo(0, -15);  // Vè½´
ctx.lineTo(0, 15);

// 2. åŒå¿ƒåœ†
ctx.arc(0, 0, 15, 0, Math.PI * 2); // å¤–åœˆ
ctx.arc(0, 0, 10, 0, Math.PI * 2); // ä¸­åœˆ
ctx.arc(0, 0, 5, 0, Math.PI * 2);  // å†…åœˆ

// 3. LEDæŒ‡ç¤ºå™¨
ctx.rect(-5, 16.5, 5, 1.5); // ç»¿è‰²çŸ©å½¢

// 4. æ¨¡å¼æ ‡è¯†
ctx.fillText('C', 0, 25);
```

---

### Wall æ¨¡å¼ï¼ˆå£è£…ï¼‰

**ç»˜åˆ¶å†…å®¹**ï¼š
1. **140åº¦æ‰‡å½¢**ï¼šæ²¿Yè½´å‘ä¸‹å¯¹ç§°ï¼Œå·¦å³å„70åº¦
2. **æ‰«ææ³¢çº¹**ï¼šå¤–å±‚æ‰‡å½¢è¾¹ç•Œï¼ˆåŠé€æ˜ï¼‰
3. **ç»¿è‰²åœ†å¿ƒæŒ‡ç¤ºå™¨**ï¼šåŠå¾„3pxçš„å°åœ†ç‚¹

**å…³é”®å‚æ•°**ï¼š
```typescript
halfAngle: 70Â° (Math.PI * 70 / 180)
centerAngle: 90Â° (Math.PI / 2)  // Yè½´å‘ä¸‹
startAngle: 20Â°  (90Â° - 70Â°)
endAngle: 160Â°   (90Â° + 70Â°)
radius: 30px
```

**ä»£ç å®ç°**ï¼š
```typescript
// 1. æ‰‡å½¢ä¸»ä½“
ctx.arc(0, 0, 30, startAngle, endAngle);
ctx.lineTo(0, 0);
ctx.closePath();
ctx.fill();
ctx.stroke();

// 2. æ‰«ææ³¢çº¹
ctx.arc(0, 0, 39, startAngle, endAngle);  // 30 * 1.3
ctx.stroke();

// 3. ç»¿è‰²åœ†å¿ƒ
ctx.arc(0, 0, 3, 0, Math.PI * 2);
ctx.fillStyle = '#00ff00';
ctx.fill();
```

---

### Corn æ¨¡å¼ï¼ˆè§’è£…ï¼‰

**ç»˜åˆ¶å†…å®¹**ï¼š
1. **90åº¦æ‰‡å½¢**ï¼šæ²¿Yè½´å‘ä¸‹å¯¹ç§°ï¼Œå·¦å³å„45åº¦
2. **æ‰«ææ³¢çº¹**ï¼šå¤–å±‚æ‰‡å½¢è¾¹ç•Œï¼ˆåŠé€æ˜ï¼‰
3. **ç»¿è‰²åœ†å¿ƒæŒ‡ç¤ºå™¨**ï¼šåŠå¾„3pxçš„å°åœ†ç‚¹

**å…³é”®å‚æ•°**ï¼š
```typescript
halfAngle: 45Â° (Math.PI * 45 / 180)
centerAngle: 90Â° (Math.PI / 2)  // Yè½´å‘ä¸‹
startAngle: 45Â°  (90Â° - 45Â°)
endAngle: 135Â°   (90Â° + 45Â°)
radius: 30px
```

**ä»£ç å®ç°**ï¼š
```typescript
// 1. æ‰‡å½¢ä¸»ä½“
ctx.arc(0, 0, 30, startAngle, endAngle);
ctx.lineTo(0, 0);
ctx.closePath();
ctx.fill();
ctx.stroke();

// 2. æ‰«ææ³¢çº¹
ctx.arc(0, 0, 39, startAngle, endAngle);  // 30 * 1.3
ctx.stroke();

// 3. ç»¿è‰²åœ†å¿ƒ
ctx.arc(0, 0, 3, 0, Math.PI * 2);
ctx.fillStyle = '#00ff00';
ctx.fill();
```

---

## ğŸ”§ æ—‹è½¬å¤„ç†ï¼ˆä¸Šå±‚ï¼‰

### å®ç°ä½ç½®
`src/utils/drawObjects.ts` çš„ `drawDeviceObject()` å‡½æ•°

### ä»£ç é€»è¾‘
```typescript
case 'Radar':
  const setupModel = device.iot?.setupModel || 'ceiling';
  
  // å¦‚æœæœ‰æ—‹è½¬è§’åº¦ï¼Œåœ¨è°ƒç”¨ç»˜åˆ¶å‰åº”ç”¨æ—‹è½¬å˜æ¢
  if (obj.angle && obj.angle !== 0) {
    ctx.save();
    ctx.translate(position.x, position.y);
    ctx.rotate((obj.angle * Math.PI) / 180);  // åº¦è½¬å¼§åº¦
    ctx.translate(-position.x, -position.y);
    drawRadarDevice(ctx, position, visual, setupModel);
    ctx.restore();
  } else {
    drawRadarDevice(ctx, position, visual, setupModel);
  }
  break;
```

### å˜æ¢é¡ºåº
```
1. ctx.translate(position.x, position.y)  â†’ ç§»åŠ¨åˆ°é›·è¾¾ä½ç½®
2. ctx.rotate(angle)                      â†’ æ—‹è½¬
3. ctx.translate(-position.x, -position.y) â†’ ç§»å›åŸç‚¹
4. drawRadarDevice()                       â†’ ç»˜åˆ¶å›¾æ ‡
5. ctx.restore()                           â†’ æ¢å¤çŠ¶æ€
```

---

## ğŸ“Š å‡½æ•°ç­¾åå¯¹æ¯”

### æ—§ç‰ˆï¼ˆé”™è¯¯ï¼‰
```typescript
export function drawRadarDevice(
  ctx: CanvasRenderingContext2D,
  position: Point,
  visual: BaseObject['visual'],
  setupModel: 'ceiling' | 'wall' | 'corn' = 'ceiling',
  rotation: number = 0  // âŒ ä¸åº”è¯¥åœ¨è¿™é‡Œå¤„ç†
): void
```

### æ–°ç‰ˆï¼ˆæ­£ç¡®ï¼‰
```typescript
export function drawRadarDevice(
  ctx: CanvasRenderingContext2D,
  position: Point,
  visual: BaseObject['visual'],
  setupModel: 'ceiling' | 'wall' | 'corn' = 'ceiling'  // âœ… åªè´Ÿè´£ç»˜åˆ¶
): void
```

---

## ğŸ¯ åæ ‡ç³»è¯´æ˜

### ç»˜åˆ¶åæ ‡ç³»ï¼ˆç›¸å¯¹ï¼‰
```
å‡½æ•°å†…éƒ¨ä½¿ç”¨ (0, 0) ä¸ºä¸­å¿ƒ
é€šè¿‡ ctx.translate(position.x, position.y) ç§»åŠ¨
```

### Canvasåæ ‡ç³»
```
        Y
        â†“
        â”‚
        â”‚
  â”€â”€â”€â”€â”€â”€â—â”€â”€â”€â”€â”€â”€â†’ X
        â”‚
        â”‚
        
åŸç‚¹åœ¨å·¦ä¸Šè§’
+X å‘å³
+Y å‘ä¸‹
```

### é›·è¾¾åæ ‡ç³»æ˜ å°„
```
é›·è¾¾åæ ‡ â†’ Canvasåæ ‡
+H (å·¦)  â†’ -X (å·¦)
-H (å³)  â†’ +X (å³)
+V (å‰)  â†’ +Y (ä¸‹)
-V (å)  â†’ -Y (ä¸Š)
```

### æ‰‡å½¢æ–¹å‘ï¼ˆWall/Cornï¼‰
```
é»˜è®¤ï¼ˆangle = 0Â°ï¼‰ï¼š
- æ‰‡å½¢ä¸­è½´æ²¿ +Y æ–¹å‘ï¼ˆå‘ä¸‹ï¼‰
- å¯¹åº”é›·è¾¾ +V æ–¹å‘ï¼ˆå‰æ–¹ï¼‰
- startAngle < 90Â° < endAngle
```

---

## ğŸ¨ è§†è§‰æ•ˆæœ

### Ceiling æ¨¡å¼
```
     â”‚ Vè½´
  â”€â”€â”€â”¼â”€â”€â”€  Hè½´
     â”‚
   â•±â”€â—â”€â•²   3ä¸ªåŒå¿ƒåœ†
  â—â”€â”€â”€â”€â”€â—  è“è‰²æ¸å˜
   â•²â”€â—â”€â•±
     â”‚
    â–“â–“â–“    ç»¿è‰²LED
     C     æ¨¡å¼æ ‡è¯†
```

### Wall æ¨¡å¼ï¼ˆ140åº¦ï¼‰
```
   â•±â”€â”€â”€â•²
  â•±     â•²
 â•±   â—   â•²   æ‰‡å½¢ä¸»ä½“
â•±    ğŸŸ¢   â•²  ç»¿è‰²åœ†å¿ƒ
â”€â”€140Â°â”€â”€
  (å‘ä¸‹)
  
å·¦è¾¹ç•Œï¼š20Â°
å³è¾¹ç•Œï¼š160Â°
```

### Corn æ¨¡å¼ï¼ˆ90åº¦ï¼‰
```
    â•±â”€â•²
   â•±   â•²
  â•±  â—  â•²    æ‰‡å½¢ä¸»ä½“
 â•±   ğŸŸ¢  â•²   ç»¿è‰²åœ†å¿ƒ
 â”€â”€â”€90Â°â”€â”€â”€
  (å‘ä¸‹)
  
å·¦è¾¹ç•Œï¼š45Â°
å³è¾¹ç•Œï¼š135Â°
```

---

## ğŸ’¡ è®¾è®¡è¦ç‚¹

### 1. ä¸ºä»€ä¹ˆæ—‹è½¬åœ¨ä¸Šå±‚ï¼Ÿ
- **èŒè´£åˆ†ç¦»**ï¼šç»˜åˆ¶å‡½æ•°åªç®¡ç»˜åˆ¶ï¼Œä¸ç®¡å˜æ¢
- **å¤ç”¨æ€§å¥½**ï¼šå…¶ä»–è®¾å¤‡ä¹Ÿå¯ä»¥ç”¨åŒæ ·çš„æ–¹å¼å¤„ç†æ—‹è½¬
- **æ˜“äºç†è§£**ï¼šå˜æ¢é€»è¾‘é›†ä¸­åœ¨ä¸€ä¸ªåœ°æ–¹

### 2. ä¸ºä»€ä¹ˆç”¨ç›¸å¯¹åæ ‡ï¼Ÿ
- **ç®€åŒ–è®¡ç®—**ï¼šæ‰€æœ‰å›¾å½¢éƒ½ä»¥(0,0)ä¸ºä¸­å¿ƒ
- **æ˜“äºç†è§£**ï¼šä¸ç”¨è€ƒè™‘ç»å¯¹ä½ç½®
- **æ–¹ä¾¿æ—‹è½¬**ï¼šæ—‹è½¬å˜æ¢æ›´è‡ªç„¶

### 3. Ceilingä¸ºä»€ä¹ˆä¸åŒï¼Ÿ
- **å‚è€ƒä¹‹å‰å®ç°**ï¼šä¿æŒä¸€è‡´æ€§
- **åæ ‡çº¿å’ŒLED**ï¼šæ›´æ¸…æ™°çš„æ–¹å‘æŒ‡ç¤º
- **3ä¸ªåŒå¿ƒåœ†**ï¼šæ›´å¥½çš„è§†è§‰å±‚æ¬¡

### 4. ä¸ºä»€ä¹ˆWall/Cornç”¨ç»¿è‰²åœ†å¿ƒï¼Ÿ
- **ä¸CeilingåŒºåˆ†**ï¼šCeilingç”¨ç»¿è‰²LEDï¼ŒWall/Cornç”¨ç»¿è‰²åœ†å¿ƒ
- **æ¸…æ™°æ ‡è®°ä½ç½®**ï¼šå°åœ†ç‚¹æ¸…æ¥šåœ°æ ‡è®°é›·è¾¾å®‰è£…ç‚¹
- **ç»¿è‰²è¡¨ç¤ºå°±ç»ª**ï¼šç¬¦åˆUIè®¾è®¡æƒ¯ä¾‹

---

## ğŸ“ ä½¿ç”¨ç¤ºä¾‹

### æ·»åŠ Ceilingé›·è¾¾
```typescript
const radar = {
  typeName: 'Radar',
  geometry: { 
    type: 'point', 
    data: { x: 300, y: 300, z: 280 } 
  },
  device: {
    category: 'iot',
    iot: { setupModel: 'ceiling' }
  },
  visual: { color: '#2196F3' },
  angle: 0
};

// ç»˜åˆ¶æ—¶ï¼š
// 1. ä¸éœ€è¦æ—‹è½¬ï¼Œç›´æ¥ç»˜åˆ¶
drawRadarDevice(ctx, { x: 300, y: 300 }, visual, 'ceiling');
```

### æ·»åŠ Wallé›·è¾¾ï¼ˆå¸¦æ—‹è½¬ï¼‰
```typescript
const radar = {
  typeName: 'Radar',
  geometry: { 
    type: 'point', 
    data: { x: 100, y: 300, z: 170 } 
  },
  device: {
    category: 'iot',
    iot: { setupModel: 'wall' }
  },
  visual: { color: '#2196F3' },
  angle: 90  // å‘å³æ—‹è½¬90åº¦
};

// ç»˜åˆ¶æ—¶ï¼š
// 1. åœ¨drawObjectsä¸­åº”ç”¨æ—‹è½¬
ctx.translate(100, 300);
ctx.rotate(Math.PI / 2);  // 90åº¦
ctx.translate(-100, -300);
// 2. ç»˜åˆ¶å›¾æ ‡ï¼ˆæ‰‡å½¢ä¼šæœå‘å³ä¾§ï¼‰
drawRadarDevice(ctx, { x: 100, y: 300 }, visual, 'wall');
ctx.restore();
```

---

## ğŸ” å…³é”®å·®å¼‚æ€»ç»“

| ç‰¹å¾ | Ceiling | Wall | Corn |
|------|---------|------|------|
| **å½¢çŠ¶** | 3ä¸ªåŒå¿ƒåœ† | æ‰‡å½¢ | æ‰‡å½¢ |
| **è§’åº¦** | 360Â° | 140Â° | 90Â° |
| **æŒ‡ç¤ºå™¨** | ç»¿è‰²LEDçŸ©å½¢ | ç»¿è‰²åœ†å¿ƒ | ç»¿è‰²åœ†å¿ƒ |
| **åæ ‡çº¿** | âœ… æœ‰ | âŒ æ—  | âŒ æ—  |
| **æ¨¡å¼æ ‡è¯†** | "C"å­—ç¬¦ | âŒ æ—  | âŒ æ—  |
| **é»˜è®¤æ–¹å‘** | - | å‘ä¸‹ï¼ˆ90Â°ï¼‰ | å‘ä¸‹ï¼ˆ90Â°ï¼‰ |
| **æ—‹è½¬å¤„ç†** | ä¸Šå±‚ | ä¸Šå±‚ | ä¸Šå±‚ |

---

## ğŸ“š ç›¸å…³æ–‡ä»¶

- `src/utils/drawDevices.ts` - ç»˜åˆ¶å‡½æ•°å®ç°
- `src/utils/drawObjects.ts` - æ—‹è½¬å¤„ç†é€»è¾‘
- `src/utils/types.ts` - ç±»å‹å®šä¹‰ï¼ˆBaseObject.angleï¼‰

---

**ç‰ˆæœ¬**ï¼šv2.0  
**æ›´æ–°**ï¼š2025-10-29  
**çŠ¶æ€**ï¼šâœ… å·²å®ç°  
**æ ¸å¿ƒæ”¹è¿›**ï¼šæ—‹è½¬ç”±ä¸Šå±‚å¤„ç†ï¼ŒCeilingå‚è€ƒä¹‹å‰å®ç°

