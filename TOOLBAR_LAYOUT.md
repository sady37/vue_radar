# Toolbar 布局说明

## 尺寸更新 ✅

| 组件 | 原尺寸 | 新尺寸 | 变化 |
|------|--------|--------|------|
| **Canvas** | 620×520 | 620×**650** | +130px 高度 |
| **Waveform** | 620×520 | 620×**650** | +130px 高度 |
| **Toolbar** | **200**×520 | **240**×**650** | +40px 宽度，+130px 高度 |
| **Spacer** | 10×520 | 10×**650** | +130px 高度 |
| **总宽度** | 1460px | **1500px** | +40px |
| **总高度** | 520px | **650px** | +130px |

---

## Toolbar 布局结构

### 第1区：绘图工具（2行）

```
┌─────────────────────────┐
│ 📏 Line    ▭ Rectangle  │ 第1行
│ ◔ Sector   ⭕ Circle    │ 第2行
└─────────────────────────┘
```

**功能**：选择绘图模式
- Line（线段）
- Rectangle（矩形）
- Sector（扇形）
- Circle（圆形）

点击激活，再次点击取消。激活状态高亮显示。

---

### 第2区：家具/结构（4行）

```
┌─────────────────────────┐
│ 🛏️ Bed      🚪 Enter    │ 第3行
│ 🚫 Exclude               │
│ 🧱 Wall     📺 Curtain  │ 第4行
│ 📦 Other                 │
└─────────────────────────┘
```

**功能**：添加家具和结构
- Bed（床）
- Enter（进入区）
- Exclude（排除区）
- Wall（墙体）
- Curtain（窗帘）
- Other（其他）

点击添加到画布。

---

### 第3区：IoT设备（2行）

```
┌─────────────────────────┐
│ 📡 Radar    🛏️ SleepAd  │ 第5行
│ 🔍 Sensor                │
└─────────────────────────┘
```

**功能**：添加IoT设备
- Radar（雷达）
- SleepAide（睡眠监测器）
- Sensor（传感器）

点击添加到画布。

---

### 第4区：操作按钮（4行）

```
┌─────────────────────────┐
│ ✨ Create   🗑️ Delete   │ 第6行
│ 💾 Save                  │ 第7行
│ 📤 Export   📥 Import   │ 第8行
│ ❤️/🤍 Vital              │
└─────────────────────────┘
```

**功能**：基本操作
- Create（创建对象）
- Delete（删除选中对象）
- Save（保存布局）
- Export（导出数据）
- Import（导入数据）
- Vital（切换生命体征显示）

---

### 第5区：属性编辑（动态显示）

**显示条件**：当有对象被选中时显示

#### 5.1 通用属性

```
📝 属性编辑
─────────────────
Name: [输入框]

几何属性:
L: [___] (长度)
W: [___] (宽度)
H: [___] (高度)
半径: [___]
弧度: [___]
反射率: [___]

☑ 仅边框
```

#### 5.2 IoT设备属性（仅IoT设备显示）

```
IoT 配置:
Status: [Online/Offline]
```

#### 5.3 雷达专属属性（仅雷达显示）

```
Setup: [下拉选择: Ceiling/Wall/Corn]
Work: [下拉选择: Fall Detect/Vital Sign/Sleep]

边界:
左: [___]
右: [___]
前: [___]
后: [___]

☑ 显示边界
☑ 显示信号区
```

---

### 第6区：视图控制（固定显示）

```
🎛️ 视图控制
─────────────────
坐标: X: 310, Y: 0
角度: 0°

☑ Local
☑ 标尺 (网格)
☑ 标线 (刻度)

    ↑
  ← → 
    ↓

↶ -15°  ↷ +15°
```

**功能**：
1. **状态显示**
   - 当前坐标位置
   - 当前旋转角度

2. **显示选项**
   - Local（本地坐标系）
   - 标尺（网格显示）
   - 标线（刻度显示）

3. **方向键**
   - 上下左右移动选中对象
   - 每次移动10个单位

4. **旋转按钮**
   - 左旋转15°
   - 右旋转15°

---

## 布局特点

### 1. 紧凑设计
- 按钮采用2列布局
- 图标+文字简洁明了
- 充分利用240px宽度

### 2. 分区清晰
- 6个功能区，每区有边框和背景色区分
- section标题明确
- 相关功能归类

### 3. 响应式显示
- 属性编辑区动态显示/隐藏
- 根据对象类型显示不同属性
- 雷达特殊配置独立显示

### 4. 操作直观
- 所有按钮有图标+文字
- 激活状态高亮显示
- hover效果明显

---

## 使用流程

### 场景1：添加雷达并配置

1. 点击 `📡 Radar` 按钮
2. 雷达出现在画布中心
3. 自动选中，属性编辑区显示
4. 修改 Setup 模式（Ceiling/Wall/Corn）
5. 调整边界参数
6. 使用方向键移动位置
7. 使用旋转按钮调整角度
8. 勾选"显示边界"查看雷达范围

### 场景2：绘制矩形床

1. 点击 `▭ Rectangle` 激活绘图模式
2. 在画布上拖拽绘制
3. 绘制完成后自动选中
4. 在属性区修改 L（长）和 W（宽）
5. 修改名称为"Bed"
6. 调整反射率
7. 点击 `💾 Save` 保存

### 场景3：导入已有布局

1. 点击 `📥 Import`
2. 选择JSON文件
3. 所有对象自动加载到画布
4. 选中任意对象可查看/编辑属性

---

## 数据流

```
Toolbar               Store                 Canvas
───────               ─────                 ──────

点击添加按钮 ─────►  objectsStore.addObject()  ─────► 自动绘制
                      ↓
                   对象列表更新
                      ↓
选中对象 ◄──────  selectedObject  ◄────── 点击画布对象
  ↓                                          ↑
显示属性编辑区                            监听变化
  ↓                                          ↑
修改属性 ─────►  updateObject()  ─────► 自动重绘
```

---

## 样式规范

### 颜色

- 主色调：`#2196F3` (蓝色)
- 背景色：`#f8f8f8` (浅灰)
- 边框色：`#e0e0e0` (中灰)
- 激活色：`#2196F3` (蓝色背景)
- 在线状态：`#4caf50` (绿色)

### 尺寸

- 按钮高度：28px
- 按钮内边距：6px 4px
- 输入框高度：24px
- section间距：10px
- 字体大小：11px

### 间距

- section padding：8px
- 按钮间距：4px
- 输入框间距：3px
- 标签margin：4px

---

## 响应式行为

### 滚动
- Toolbar 超过650px高度时自动显示滚动条
- 滚动条样式：6px宽，圆角

### 折叠
- 点击 spacer 可折叠/展开 Toolbar
- 折叠动画：0.3s ease
- 折叠状态：width: 0

### 自适应
- 属性编辑区根据选中对象类型调整内容
- IoT配置仅IoT设备显示
- 雷达配置仅雷达显示

---

## 键盘快捷键（规划）

| 按键 | 功能 |
|------|------|
| `L` | 激活Line工具 |
| `R` | 激活Rectangle工具 |
| `C` | 激活Circle工具 |
| `S` | 激活Sector工具 |
| `Del` | 删除选中对象 |
| `Ctrl+S` | 保存布局 |
| `↑↓←→` | 移动选中对象 |
| `Ctrl+Z` | 撤销 |
| `Ctrl+Y` | 重做 |

---

## 技术实现

### Store集成

```typescript
import { useCanvasStore, useObjectsStore } from '@/stores';

const canvasStore = useCanvasStore();
const objectsStore = useObjectsStore();

// 双向绑定
const showGrid = computed({
  get: () => canvasStore.showGrid,
  set: (value) => { canvasStore.showGrid = value; }
});

// 选中对象
const selectedObject = computed(() => objectsStore.selectedObject);
```

### 计算属性

```typescript
// 动态获取几何属性
const geometryProps = computed(() => {
  if (!selectedObject.value) return {};
  // 根据geometry.type返回相应属性
});

// 判断设备类型
const isIotDevice = computed(() => 
  selectedObject.value?.device.category === 'iot'
);
```

### 响应式更新

- watch监听 store 变化
- 自动同步到画布重绘
- 无需手动触发更新

---

## 测试清单

- [ ] 所有按钮可点击
- [ ] 绘图工具激活/取消正常
- [ ] 添加对象成功显示在画布
- [ ] 选中对象显示属性编辑区
- [ ] 修改属性实时更新到画布
- [ ] 方向键移动对象正常
- [ ] 旋转按钮工作正常
- [ ] 删除对象成功
- [ ] 显示选项切换正常
- [ ] 滚动条正常工作
- [ ] 折叠/展开动画流畅

---

**版本**：v2.0  
**更新时间**：2025-10-29  
**状态**：✅ 已完成重构

